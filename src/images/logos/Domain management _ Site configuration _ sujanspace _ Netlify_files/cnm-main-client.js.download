(()=>{var tt=Date.now(),H=!("window"in globalThis)&&"serviceWorker"in globalThis,X="SW_VERSION_LOCAL",Y="d8ecde65",z="netlify-cnm",ye="cnm-settings.json",nt=`/${z}/${ye}`,De="cnm-sw.js",W=`/${De}`,G="/cnm-main-client.js",xe="cnm.js",J=`/${z}/${xe}`,Z="https://client-network-manager.netlify.app",rt=`${Z}${W}`,ot=`${Z}${G}`;var Q=1,v="__cnm-debug",k="__cnm-settings",C="ntl-cnm-",st=1e3*60,it=1e3*10,at=1e3*60*60*4,He=["html","htm"],We=["js","mjs"],Ge=["css"],ve=["svg","jpg","jpeg","gif","png","webp","avif","bmp","ico"],ke=["tiff","tif","woff","woff2","ttf"],Ue=["aif","cda","mid","midi","mp3","mpa","wav","wma"],Fe=["avi","mp4","mov"],ct=[...He,...We,...Ge,...ve,...ke,...Ue,...Fe,"txt","pdf"];var ee="disabled";var te="enabled",ne="enabled",re="disabled";var oe="cnm-sig-db-v1";var se="cnm-settings-v1";var ie="cnm-hits-v1";var ae="api",ce="config",le="lookahead";var Be=1e3*60,lt=1e3*60*60,gt=1e3*60*60;var $e="nomod",ut=$e.length;var p=!1,Ke="localStorage"in globalThis&&globalThis.document!==void 0,qe=Ke?`MAIN-${Y}`:`SW-${X}`,ge=!1;function de(){if(!ge){ge=!0;try{JSON.parse(localStorage.getItem("cnm-debug")||"")===!0&&(p=!0)}catch{}}}function U(e){try{p!==!!e&&(p=!!e,p?localStorage.setItem("cnm-debug",JSON.stringify(p)):localStorage.removeItem("cnm-debug"))}catch{}}function fe(){return U(!p)}function F(){return location.href.includes(v)?!location.href.includes(`${v}=0`):null}function R(e,...t){p&&console[e](...t)}function N(e,t=90,n=80){let r=0;for(let s=0;s<e.length;s++)r=e.charCodeAt(s)+((r<<5)-r),r=r&r;return`hsl(${r%360}, ${t}%, ${n}%)`}var ue=e=>{let t=`%cCNM ${qe} ::`;return e&&(t=`${t} ${e} ::`),{log:R.bind(null,"log",t,`background: ${e?N(e):"#bbb"}`),error:R.bind(null,"error",t,`background: ${e?N(e):"#bbb"}`),warn:R.bind(null,"warn",t,`background: ${e?N(e):"#bbb"}`),info:R.bind(null,"info",t,`background: ${e?N(e):"#bbb"}`),table:R.bind(null,"table",t,`background: ${e?N(e):"#bbb"}`)}},_={...ue(),namespace:e=>({...ue(e)})};function d(){let e=new URL(location.href),t=globalThis.netlify?.cnm?.settings;if(e.searchParams.has(k)){let n=JSON.parse(e.searchParams.get(k)||""),r={...t};return n?.clientCaching&&(r.clientCaching=n.clientCaching),n?.cachingOptions&&(r.cachingOptions=n.cachingOptions),r}return t}function T(){return d()?.clientCaching!==ee}var b={},P=_.namespace("MSG-HANDLER"),_e=!1,B;H&&self.addEventListener("message",Se);function Ee(e){P=_.namespace("MSG-HANDLER"),b=e.messageHandlers||{},B=e.signalsManager,e.messageListener&&!_e&&(_e=!0,e.messageListener.addEventListener("message",Se))}function Se(e){if(!e.data||!e.data.cnm)return;let{type:t,payload:n}=e.data,r=e.source;Object.keys(b).forEach(s=>{if(s===t||s.startsWith(`${t}_once_`)){let i=b[s];if(i)try{P.log(`start message handler for type "${t}"`);let c={type:t,payload:n,client:r};H&&B&&(c.serviceWorkerContext={signalsManager:B}),i(c),P.log(`end message handler for type "${t}"`)}catch(c){P.error(`message handler for type "${t}" threw an error`),P.error(c)}s.includes("_once_")&&delete b[s]}})}var Ve=0;function he(e,t){b[`${e}_once_${Ve}`]=t}function u(e,t={}){let n=navigator?.serviceWorker?.controller;n&&(T()||e==="SELF_DESTRUCT")&&n.postMessage({cnm:!0,type:e,payload:t})}var L=!0;try{globalThis.localStorage.getItem("access_check__")}catch{L=!1}var pe=e=>L?globalThis.localStorage.getItem(e):void 0,me=(e,t)=>L?globalThis.localStorage.setItem(e,t):void 0,Ce=e=>L?globalThis.localStorage.removeItem(e):void 0;function Te(e){return e.pathname.startsWith(W)||e.pathname.startsWith(G)||e.pathname.startsWith(J)}var w={},I=_.namespace("CACHE");function Ie(e){return e&&`${C}-${Q}-${e}`}async function je(e){I.log("start clearing caches",{signalKeys:e}),await Promise.allSettled(e.map(async t=>{let n="";typeof t=="object"?n=t.raw:typeof t=="string"&&(n=t),n&&(n=n.startsWith(C)?n:Ie(n),w[n]||(w[n]=await caches.open(n)),w[n]&&(caches.delete(n),delete w[n]))})),I.log("end clearing caches",{signalKeys:e})}async function Xe(e){I.log("start clearing all caches except these signals",{signalKeys:e});let t=await caches.keys(),n=e.map(({raw:s})=>Ie(s)),r=t.filter(s=>!n.includes(s)&&s.startsWith(C));r.length>0&&(I.log("keep cache keys",n),I.log("delete cache keys",r)),await je(r),I.log("end clearing all other caches")}async function Ae(){await Xe([])}function Re(){if(d().cachingOptions?.precachingLookahead===re)return;let e=[];document.querySelectorAll("img[loading=lazy]").forEach(t=>{"complete"in t&&!t.complete&&("currentSrc"in t&&t.currentSrc?e.push({url:t.currentSrc,destination:"image"}):"src"in t&&t.src?e.push({url:t.src,destination:"image"}):"href"in t&&t.href&&e.push({url:t.href,destination:"image"}))}),e.length>0&&O(e,le)}function O(e,t){u("PRECACHE_RESOURCES",{resources:e,src:t})}var Ne=({payload:e})=>{if(d().cachingOptions?.precachingLookahead===ne&&e&&typeof e.maxPrecache=="number"){let{maxPrecache:n}=e,r=0;document.querySelectorAll("img[loading=lazy]").forEach(s=>{"complete"in s&&!s.complete&&"loading"in s&&r<=n&&(s.loading="eager",r++)})}},Pe=()=>{let e=d().cachingOptions?.precachingConfiguredRoutes;Array.isArray(e)&&e.length>0&&O(e.map(t=>({url:t})),ce)};function m(e,t,n){let r=e.length;if(!r)return;if(n=Object.prototype.toString.call(n)=="[object Function]"?n:function(l){return l},t=+t,t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);let s=(r-1)*t,i=Math.floor(s),c=+n(e[i],i,e),f=+n(e[i+1],i+1,e);return c+(f-c)*(s-i)}var M=self.location.origin,Ye=self.location.hostname,ze=Ye==="netlify.com"||M.endsWith(".netlify.com")||M.endsWith("--app.netlify.app")||M.endsWith("--docs.netlify.app")||M.endsWith("--www.netlify.app"),Je=_.namespace("rum-reporter");function y(){return ze&&"DD_RUM"in window}function A(e,t){y()&&window.DD_RUM.addAction(e,t)}function D(e,t){y()&&window.DD_RUM.addRumGlobalContext(e,t)}var be={meta:{},stats:{},races:[]},S={...be};async function Ze(e="unknown"){if(document.visibilityState==="hidden"||!y())return;let t=await Promise.race([window.netlify?.cnm?.getStats?.(),new Promise(a=>{setTimeout(()=>{a(null)},1e3)})]);if(!t||typeof t!="object"||!("stats"in t))return;let n=t,r=!!(n&&"meta"in n)&&typeof n.stats=="object",s=S?.meta?.version;n.meta.version&&s&&s!==n.meta.version&&(S={...be});let i=!!(S&&"meta"in S)&&typeof S.stats=="object",c=r&&i?Object.keys(n.stats).reduce((a,g)=>(isNaN(n.stats[g])||isNaN(S.stats[g])?a[g]=n.stats[g]:a[g]=n.stats[g]-S.stats[g],a),{}):n.stats,f={...n,stats:c,races:[]},l={};if("races"in n&&Array.isArray(n.races)){let a=n.races,g=S.races.length?a.slice(S.races.length):a;f.races=g}else f.races=[];if(f.races.length>0){l.count=f.races.length;let a=f.races.map(({delta:o})=>o).filter(o=>!isNaN(o)&&o!==1/0).sort((o,E)=>o-E);l.deltaAvg=a.reduce((o,E)=>o+E,0)/a.length,l.deltaP0=a[0],l.deltaP25=m(a,.25,o=>o),l.deltaP50=m(a,.5,o=>o),l.deltaP75=m(a,.75,o=>o),l.deltaP100=a[a.length-1];let g=f.races.map(({newPathResult:o,oldPathResult:E})=>{let j=(o-E)/E;return j?Math.round((j*100+Number.EPSILON)*100)/100:0}).filter(o=>!isNaN(o)&&o!==1/0).sort((o,E)=>o-E);l.changePercAvg=g.reduce((o,E)=>o+E,0)/g.length,l.changePercP0=g[0],l.changePercP25=m(g,.25,o=>o),l.changePercP50=m(g,.5,o=>o),l.changePercP75=m(g,.75,o=>o),l.changePercP100=g[g.length-1],l.slowerCount=a.filter(o=>o>0).length,l.fasterCount=l.count-l.slowerCount,y()&&f.races.forEach(o=>{!o.newPathResult||!o.oldPathResult||A("RACE_RESULT",{raceType:"cnm-fetch-race",raceCondition:e,totalInGroup:f.races.length,deltaChangePercentage:(o.newPathResult-o.oldPathResult)/o.oldPathResult*100,deltaChangeMultiple:o.oldPathResult/o.newPathResult,...o})})}if(r){let a={...f,raceResults:l,cnmStatsTrigger:e};delete a.races,Je.log("Stats from last view change",a),A("CNM_STATS",a)}S=n}var Qe=0,$;function Le(){$&&clearTimeout($),$=setTimeout(()=>{Ze(Qe++===0?"page_load":"route_change")},3e3)}function q(e){document.readyState==="complete"?e():window.addEventListener("load",e)}function K(){we.forEach(e=>e())}var we=[];q(function(){window.addEventListener("popstate",K);let e=window.history.pushState;window.history.pushState=function(...n){return K(),e.apply(window.history,n)};let t=window.history.replaceState;window.history.replaceState=function(...n){return K(),t.apply(window.history,n)}});function Oe(e){we.push(e),e()}var x=_.namespace("destroyer");async function V(){let e=d();if("serviceWorker"in navigator&&e?.cnmSWLocation){let t=await navigator.serviceWorker.getRegistrations(),n=new URL(e.cnmSWLocation,location.origin).href,r=t.find(({active:s})=>s&&s.scriptURL===n);if(r)x.log("start destroying sw and artifacts"),u("SELF_DESTRUCT"),setTimeout(()=>{r.unregister().then(s=>{x.log(`sw unregistered itself? ${s?"main thread unregistered":"sw self destroyed"}.`)})},100);else{let s=await caches.keys();s.length>0&&s.find(c=>c.startsWith(C))?await Promise.allSettled([Ae(),()=>{self.indexedDB.deleteDatabase(se),self.indexedDB.deleteDatabase(oe),self.indexedDB.deleteDatabase(ie)}]).then(c=>{x.log("end destroying sw and artifacts",{results:c})}):x.log("sw or artifacts do not exist, not running destroy fns")}}}de();var h=_.namespace("MAIN-CLIENT");async function et(){let e=d();if("serviceWorker"in navigator&&e?.cnmSWLocation){let t=await navigator.serviceWorker.getRegistrations(),n=!1,r=new URL("/",location.origin).href,s=new URL(e.cnmSWLocation,location.origin).href;t.forEach(({scope:i,active:c})=>{i===r&&c&&c.scriptURL!==s&&(n=!0)});try{if(n)return;await navigator.serviceWorker.register(e.cnmSWLocation,{updateViaCache:"none"}),Me(),Ee({messageHandlers:{SW_ACTIVATION_PROCESS_COMPLETE:()=>Me(),GET_PRE_CNM_ASSET_REFS:()=>{q(()=>{let i=[];performance.getEntriesByType("resource").filter(({name:c})=>{c.startsWith(location.origin)&&!Te(new URL(c,location.origin))&&i.push(c)}),A("CNM_PRE_CNM_RESOURCES",{resourceCount:i.length}),i.length>0?(h.log("Hydrate pre-CNM resources",i),u("HYDRATE_RESOURCES_FROM_HTTP_CACHE",{resources:i})):h.log("no pre-CNM should be hydrated",i)})},HYDRATION_STATS:({payload:i})=>{i&&(h.log("hydrate resource stats",i),A("CNM_HYDRATION_STATS",i))},PRECACHE_STATS:({payload:i})=>{i&&(h.log("precaching stats",i),A("CNM_PRECACHE_STATS",i))},PRECACHE_LOOKAHEADS:Ne},messageListener:navigator.serviceWorker})}catch(i){h.error(`Registration failed with ${i}`)}}}function Me(){u("EXPLICIT_ACTIVATE");let e=F();e&&u("TOGGLE_DEBUG",{on:e}),u("UPDATE_CLIENT_SETTINGS",d()),Pe()}(async()=>{if(window.__cnmjsInvoked){h.error("client has been loaded multiple times. This script will stop");return}window.__cnmjsInvoked=!0;let e=F();e!==null&&await U(e);let t=d();if(!t){h.error("settings have not been provided by the snippet. This client will not run");return}window.netlify=window.netlify||{},window.netlify.cnm=window.netlify.cnm||{},window.netlify.cnm.refreshSignal=()=>u("EXPLICIT_SIGNAL_FETCH"),window.netlify.cnm.fetchUrlFromCache=r=>u("FETCH_FROM_CACHE",{url:r}),window.netlify.cnm.precacheResources=r=>O(r,ae),window.netlify.cnm.messageSW=u,window.netlify.cnm.getStats=()=>new Promise(r=>{he("NET_STATS",({payload:s})=>{r(s)}),u("GET_NET_STATS")}),window.netlify.cnm.toggleDebug=()=>{u("TOGGLE_DEBUG"),fe()},window.netlify.cnm.destroySW=()=>V();let n=!!pe("cnm_sw_enabled")&&T();T()?(h.log("SW is Enabled. Setting value: ",t.clientCaching),et(),n||me("cnm_sw_enabled","true")):(h.log("SW is disabled. Setting value: ",t.clientCaching),V(),Ce("cnm_sw_enabled")),Oe(()=>{Le(),Re()}),D("cnmSWEnabled",T()),D("cnmSWPreviouslyEnabled",n),D("cnmNavResourceAffinityEnabled",d().cachingOptions?.navResourceAffinity===te)})();})();
